version: 2.1
jobs:
  run_tests:
    docker:
      - image: cimg/node:18.20 # upgraded from circleci/node:12 to support optional chaining used in mocha-junit-reporter
    steps:
      - checkout
      - run:
          name: Install npm dependencies
          command: npm ci
      - run:
          name: Run Unit Tests (JUnit XML)
          command: npm test
      - run:
          name: Package JUnit report zip
          command: |
            mkdir -p artifacts
            command -v zip >/dev/null || (sudo apt-get update -y && sudo apt-get install -y zip)
            zip -j artifacts/junit-report.zip reports/junit/*.xml
      - store_artifacts:
          path: artifacts/junit-report.zip
workflows:
  sanjay-test-workflow:
    jobs:
      - run_tests
